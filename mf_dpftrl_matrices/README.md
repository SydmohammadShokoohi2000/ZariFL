# MF-DP-FTRL for Gboard

This folder contains the matrices generated by
[(Amplified) Banded Matrix Factorization: A unified approach to private training](https://arxiv.org/abs/2306.08153)
for two settings

-   Total rounds 2000 and band size of 400
-   Total rounds 2000 and band size of 1000

These pre-generated matrices can be used in the matrix factorization
differentially private follow the regularized ladder (MF-DP-FTRL) algorithm to
achieve strong privacy-utility-computation trade-offs in both centralized and
federated learning.

The launched Next Word Prediction (NWP) language models (LMs) in Gbaord have the
following privacy parameters

-   The Spanish model in Spain is trained with the 400-banded matrices. Compared
    to the experiment in the [paper](https://arxiv.org/abs/2306.08153), the same
    `l2_clip_norm_noise_multiplier`[^1] of 1.411 is used, while the min
    separation is improved to 484. With the max participation of 3, we can
    achieve $$\rho=0.15$$ zCDP, and alternatively, $$(\epsilon=3.42,
    \delta=10^{-10})$$-DP.
-   The Portuguese model in Brazil is trained with the 1000-banded matrices. The
    `l2_clip_norm_noise_multiplier` of 8.35 is used. With min separation of 1428
    and max participation of 2, we can achieve $$\rho=0.0144$$ zCDP, and
    alternatively, $$(\epsilon=0.994, \delta=10^{-10})$$-DP.
-   The Spanish model in Latin America is trained with the 1000-banded matrices.
    The `l2_clip_norm_noise_multiplier` of 8.35 is used. With min separation of
    1132 and max participation of 2, we can achieve $$\rho=0.0144$$ zCDP, and
    alternatively, $$(\epsilon=0.994, \delta=10^{-10})$$-DP.

See the colab in this folder for details of privacy accounting.

[^1]: Note that the `l2_clip_norm_noise_multiplier` parameter we specified in
    model training is used for computing the standard deviation of the
    Gaussian noise given the clipping norm parameter for each client update,
    which is different from a conventional noise multiplier definition in DP
    for privacy accounting. See the colab for details on using
    `l2_clip_norm_noise_multiplier` together with total sensitivity
    computation for privacy accounting.
